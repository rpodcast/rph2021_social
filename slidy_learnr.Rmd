---
title: "slidy learnr"
output: slidy_presentation
runtime: shiny_prerendered
description: >
  This is a demo of a learnr tutorial in slidy format
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(learnr)
library(dygraphs)
library(dplyr)
library(purrr)

question2 <- purrr::lift_dl(question)

qbank <- list(
  q1 = list(
    text = "What number is the letter A in the English alphabet?",
    type = "learnr_radio",
    answers = list(
      list(
        text = "8",
        correct = FALSE
      ),
      list(
        text = "14",
        correct = FALSE
      ),
      list(
        text = "1",
        correct = TRUE
      ),
      list(
        text = "23",
        correct = FALSE
      )
    )
  ),
  q2 = list(
    text = "Who is the best?",
    type = "learnr_radio",
    answers = list(
      list(
        text = "Jericho",
        correct = TRUE
      ),
      list(
        text = "Nia",
        correct = FALSE
      )
    )
  )
)

# assumes x is a list pertaining to the invidual question
# this function does not work when put into a chunk
# so I guess I need to make this like a child rmarkdown fragment
gen_question <- function(x, type = "leanr_radio") {
  df <- tibble::tibble(
    f = rep("answer", length(x[["answers"]])),
    params = x[["answers"]]
  )

  #tmp <- invoke_map(df$f, df$params)
  question2(invoke_map(df$f, df$params), text = x[["text"]], type = type)
}


gen_question_rmd <- function(x, label, type = "learnr_radio") {
  withr::local_options(list(htmltools.preserve.raw = FALSE))
  label <- label
  tmp <- markdown(knitr::knit_child(
    text = c(
glue::glue('```{r <<label>>, echo=FALSE}', label = label, .open="<<", .close=">>"),
'question2 <- lift_dl(question)',
'',
'df <- tibble::tibble(f = rep("answer", length(x[["answers"]])), params = x[["answers"]])',
'',
'tmp <- invoke_map(df$f, df$params)',
'',
'question2(tmp, text = x[["text"]], type = type)',
'',
'```',
''
    ), envir = environment(), quiet = TRUE))
  return(tmp)
}
```

```{r create-slides, include=FALSE}
out <- purrr::map_chr(seq_along(qbank), ~{
  glue::glue("\n\n## Question <<i>>\n\n```{r q-<<i>>, echo=FALSE}\nHTML(gen_question_rmd(qbank[[<<i>>]], label='qq<<i>>'))\n```\n\n",
             i = .x,
             .open = "<<",
             .close = ">>")
})
```

`r paste(knitr::knit_child(text = out), collapse = '\n')`

## Old 1

```{r qqq, eval = FALSE, echo=FALSE}
HTML(gen_question_rmd(x = qbank[[1]]))
```

## Old 2

```{r letter-a, echo=FALSE, eval=FALSE}
#answers <- purrr::walk(qbank$q1$answers, function(x) learnr::answer, x)
#question(qbank$q1$text, purrr::map(qbank$q1$answers, ~rlang::call2("answer", .x)))
second.function <- function(..., name) {
  print(paste("This is the name:", name))
  print(paste("These are the arguments:", ...))
}

first.function <- function(..., name) {
  argument.list <- list(...)

  new.args <- lapply(argument.list, `^`, 2) 
  new.args[["name"]] <- name

  do.call(second.function, new.args)
}

# this works but is hard-coded
do.call(
  question, 
  list(
    text = qbank$q1$text, 
    do.call(
      answer, qbank$q1$answers[[1]]
    ),
    do.call(
      answer, qbank$q1$answers[[2]]
    ),
    do.call(
      answer, qbank$q1$answers[[3]]
    ),
    do.call(
      answer, qbank$q1$answers[[4]]
    )
  )
)
#first.function(1, 2, 3, name = "Test")



#purrr::walk(qbank$q1$answers, ~rlang::exec(learnr::answer, .x))
# question("What number is the letter A in the English alphabet? What number is the letter A in the English alphabet? What number is the letter A in the English alphabet? What number is the letter A in the English alphabet? What number is the letter A in the English alphabet? What number is the letter A in the English alphabet?",
#   answer("8"),
#   answer("14"),
#   answer("1", correct = TRUE),
#   answer("23")
# )
```


## Old 3

```{r try2, eval=FALSE}
# this works but is hard-coded
do.call(
  question, 
  list(
    text = qbank$q1$text, 
    do.call(
      answer, qbank$q1$answers[[1]]
    ),
    do.call(
      answer, qbank$q1$answers[[2]]
    ),
    do.call(
      answer, qbank$q1$answers[[3]]
    ),
    do.call(
      answer, qbank$q1$answers[[4]]
    )
  )
)

```


## Question 3

```{r where-am-i, echo=FALSE, eval=FALSE}
#gen_question(qbank[[1]])
##########################################
# question2 <- lift_dl(question)
# df <- tibble::tibble(
#   f = c("answer", "answer"),
#   params = list(
#     list(text = "14", correct = FALSE),
#     list(text = "1", correct = TRUE)
#   )
# )
# 
# tmp <- invoke_map(df$f, df$params)
# question2(tmp, text = "Hello?", type = "learnr_radio")

###############################################################

# question("Where are you right now?",
#   answer(text = "Planet Earth", correct = TRUE),
#   answer(text = "Pluto"),
#   answer(text = "At a computing device", correct = TRUE),
#   answer(text = "In the Milky Way", correct = TRUE)
# )
```
